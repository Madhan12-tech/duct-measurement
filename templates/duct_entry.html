<!DOCTYPE html>
<html>
<head>
  <title>Duct Entry</title>
  <style>
    .container { display: flex; gap: 20px; }
    .form-section { width: 40%; }
    .table-section { width: 60%; }
    table { width: 100%; border-collapse: collapse; }
    th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
    th { background-color: #eee; }
  </style>
</head>
<body style="font-family: Arial; padding: 20px;">

  {% with messages = get_flashed_messages() %}
    {% if messages %}
      <ul>
        {% for msg in messages %}
          <li>{{ msg }}</li>
        {% endfor %}
      </ul>
    {% endif %}
  {% endwith %}

  {% if project %}
    <h2>Project Details</h2>
    <p><strong>Project:</strong> {{ project[1] }} | <strong>Enquiry No:</strong> {{ project[2] }} | <strong>Office No:</strong> {{ project[3] }}<br>
       <strong>Engineer:</strong> {{ project[4] }} | <strong>Contact:</strong> {{ project[5] }} | <strong>Location:</strong> {{ project[6] }}</p>
  {% endif %}

  <div class="container">
    <div class="form-section">
      <h3>{{ 'Edit Duct Entry' if edit_entry else 'Add Duct Entry' }}</h3>
      <form method="POST" action="/add_duct">
        {% if edit_entry %}<input type="hidden" name="id" value="{{ edit_entry[0] }}">{% endif %}
        <input type="text" name="duct_no" placeholder="Duct No" required value="{{ edit_entry[1] if edit_entry else '' }}"><br><br>
        <input type="text" name="duct_type" placeholder="Duct Type" required value="{{ edit_entry[2] if edit_entry else '' }}"><br><br>
        <input type="number" step="0.01" name="width" placeholder="Width" required value="{{ edit_entry[3] if edit_entry else '' }}"><br><br>
        <input type="number" step="0.01" name="height" placeholder="Height" required value="{{ edit_entry[4] if edit_entry else '' }}"><br><br>
        <input type="number" step="0.01" name="length_or_radius" placeholder="Length/Radius" required value="{{ edit_entry[5] if edit_entry else '' }}"><br><br>
        <input type="number" name="quantity" placeholder="Quantity" required value="{{ edit_entry[6] if edit_entry else '' }}"><br><br>
        <input type="text" name="gauge" placeholder="Gauge" required value="{{ edit_entry[7] if edit_entry else '' }}"><br><br>
        <input type="number" step="0.01" name="factor" placeholder="Factor (default 1)" value="{{ edit_entry[8] if edit_entry else '1.0' }}"><br><br>
        <button type="submit">{{ 'Update' if edit_entry else 'Add' }}</button>
      </form>
    </div>

    <div class="table-section">
      <h3>Duct Entries</h3>
      <table>
        <tr>
          <th>Duct No</th><th>Type</th><th>Size (W x H)</th><th>Length</th><th>Qty</th><th>Gauge</th><th>Factor</th><th>Area</th><th>Acc</th><th>Action</th>
        </tr>
        {% for e in entries %}
          <tr>
            <td>{{ e[1] }}</td><td>{{ e[2] }}</td>
            <td>{{ e[3] }} x {{ e[4] }}</td>
            <td>{{ e[5] }}</td><td>{{ e[6] }}</td>
            <td>{{ e[7] }}</td><td>{{ e[8] }}</td>
            <td>{{ e[9] }}</td><td>{{ e[10] }}</td>
            <td>
              <a href="/edit/{{ e[0] }}">Edit</a> |
              <a href="/delete/{{ e[0] }}" onclick="return confirm('Delete this entry?');">Delete</a>
            </td>
          </tr>
        {% endfor %}
      </table>

      <h4>Totals</h4>
      <p><strong>Total Qty:</strong> {{ total.total_qty }} | <strong>Total Area:</strong> {{ total.total_area }} | <strong>Total Accessories:</strong> {{ total.total_acc }}</p>

      <form method="POST" action="/submit_all">
        <button type="submit">Submit All</button>
      </form>

      <p style="margin-top: 10px;">
        <a href="/export_excel">Download Excel</a> |
        <a href="/export_pdf">Download PDF</a>
      </p>
    </div>
  </div>

</body>
</html>

