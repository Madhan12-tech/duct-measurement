<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Duct Entry</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />
  <style>
    body.dark-mode {
      background-color: #121212;
      color: #ffffff;
    }
    .dark-mode .card, .dark-mode .modal-content {
      background-color: #1e1e1e;
    }
    .dark-mode input, .dark-mode select, .dark-mode textarea {
      background-color: #333;
      color: #fff;
    }
    .dark-mode .table {
      color: #ffffff;
    }
  </style>
</head>
<body class="">
<div class="container mt-4">
  <div class="d-flex justify-content-between mb-3">
    <h4>Duct Entry Form</h4>
    <button class="btn btn-secondary" onclick="toggleDarkMode()">
      <i class="fa fa-moon"></i> Dark Mode
    </button>
  </div>

  <div class="mb-3 p-3 border rounded">
    <h5 class="mb-2">Project: {{ project[1] }}</h5>
    <div><strong>Engineer:</strong> {{ project[4] }} | <strong>Contact:</strong> {{ project[5] }} | <strong>Location:</strong> {{ project[6] }}</div>
  </div>

  <div class="row">
    <div class="col-md-5">
      <form method="POST" action="{{ url_for('add_duct') }}">
        <input type="hidden" name="project_id" value="{{ project_id }}">
        <input type="hidden" name="id" value="{{ edit_entry[0] if edit_entry else '' }}">

        <div class="mb-2"><input type="text" name="duct_no" class="form-control" placeholder="Duct No" value="{{ edit_entry[2] if edit_entry else '' }}" required></div>
        <div class="mb-2">
          <select name="duct_type" class="form-control" required>
            <option value="">-- Duct Type --</option>
            {% for t in ['ST', 'RED', 'OFFSET', 'SHOE', 'DUM', 'ELB', 'VANES'] %}
              <option value="{{ t }}" {% if edit_entry and edit_entry[3] == t %}selected{% endif %}>{{ t }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="row mb-2">
          <div class="col"><input type="number" step="any" name="width1" class="form-control" placeholder="Width 1" value="{{ edit_entry[4] if edit_entry else '' }}" required></div>
          <div class="col"><input type="number" step="any" name="height1" class="form-control" placeholder="Height 1" value="{{ edit_entry[5] if edit_entry else '' }}" required></div>
        </div>
        <div class="row mb-2">
          <div class="col"><input type="number" step="any" name="width2" class="form-control" placeholder="Width 2 (if any)" value="{{ edit_entry[6] if edit_entry else '' }}"></div>
          <div class="col"><input type="number" step="any" name="height2" class="form-control" placeholder="Height 2 (if any)" value="{{ edit_entry[7] if edit_entry else '' }}"></div>
        </div>
        <div class="mb-2"><input type="number" step="any" name="length_or_radius" class="form-control" placeholder="Length or Radius" value="{{ edit_entry[8] if edit_entry else '' }}" required></div>
        <div class="mb-2"><input type="number" name="quantity" class="form-control" placeholder="Quantity" value="{{ edit_entry[9] if edit_entry else '' }}" required></div>
        <div class="mb-2"><input type="number" step="any" name="degree_or_offset" class="form-control" placeholder="Degree or Offset" value="{{ edit_entry[10] if edit_entry else '' }}"></div>
        <div class="mb-2">
          <select name="factor" class="form-control">
            <option value="1.0">Factor (Default 1.0)</option>
            {% for f in [1.0, 1.2, 1.5, 1.8, 2.0] %}
              <option value="{{ f }}" {% if edit_entry and edit_entry[11] == f %}selected{% endif %}>{{ f }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="d-grid mt-3">
          <button type="submit" class="btn btn-primary">
            {% if edit_entry %}Update{% else %}Submit{% endif %}
          </button>
        </div>
      </form>
    </div>

    <div class="col-md-7">
      {% if entries %}
        <table class="table table-sm table-bordered table-hover">
          <thead class="table-light">
            <tr>
              <th>Duct No</th>
              <th>Type</th>
              <th>Area</th>
              <th>Gauge</th>
              <th>Qty</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for e in entries %}
              <tr>
                <td>{{ e[2] }}</td>
                <td>{{ e[3] }}</td>
                <td>{{ "%.2f" | format(e[13]) }}</td>
                <td>{{ e[12] }}</td>
                <td>{{ e[9] }}</td>
                <td>
                  <a href="{{ url_for('edit_duct', id=e[0]) }}" class="btn btn-sm btn-warning"><i class="fa fa-edit"></i></a>
                  <a href="{{ url_for('delete_duct', id=e[0]) }}" class="btn btn-sm btn-danger" onclick="return confirm('Delete this entry?')"><i class="fa fa-trash"></i></a>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>

        <div class="mt-4">
          <h6>Total Quantity: {{ total_qty }}</h6>
          <h6>Total Area: {{ "%.2f"|format(total_area) }} sq.m</h6>
          <h6>Total Nuts & Bolts: {{ total_bolts }}</h6>
          <h6>Total Cleat: {{ total_cleat }}</h6>
          <h6>Total Gasket: {{ total_gasket }}</h6>
          <h6>Total Corner Pieces: {{ total_corner }}</h6>
        </div>

        <div class="mt-3 d-flex gap-2">
          <a href="{{ url_for('export_excel', project_id=project_id) }}" class="btn btn-success"><i class="fa fa-file-excel"></i> Excel</a>
          <a href="{{ url_for('export_pdf', project_id=project_id) }}" class="btn btn-danger"><i class="fa fa-file-pdf"></i> PDF</a>
          <button class="btn btn-dark" onclick="window.print()"><i class="fa fa-print"></i> Print</button>
        </div>
      {% else %}
        <p>No duct entries yet.</p>
      {% endif %}
    </div>
  </div>
</div>

<script>
  function toggleDarkMode() {
    document.body.classList.toggle("dark-mode");
  }
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
